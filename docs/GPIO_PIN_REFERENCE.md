# GPIO Pin Reference Guide

## Complete Pin Configuration for ESP32 3-Axis Gimbal

This document provides a comprehensive reference for all GPIO pin assignments used in the ESP32 3-Axis Gimbal Control System. This is essential for bench testing and hardware setup.

---

## Quick Reference Table

| Component | GPIO Pin | Function | Direction | Notes |
|-----------|----------|----------|-----------|-------|
| **Yaw Servo** | GPIO 13 | PWM Signal | Output | Controls base rotation |
| **Pitch Servo** | GPIO 12 | PWM Signal | Output | Controls tilt forward/back |
| **Roll Servo** | GPIO 14 | PWM Signal | Output | Controls tilt left/right |
| **MPU6050 SDA** | GPIO 8 | I2C Data | Bidirectional | Gyro/Accelerometer data (ESP32-S3) |
| **MPU6050 SCL** | GPIO 9 | I2C Clock | Output | Gyro/Accelerometer clock (ESP32-S3) |
| **Control Button** | GPIO 15 | Digital Input | Input | Hardware control button |
| **RGB Status LED** | GPIO 48 | WS2812 Data | Output | Onboard RGB LED (ESP32-S3-N16R8) |

---

## Detailed Pin Specifications

### Servo Outputs (PWM)

#### 1. Yaw Servo - GPIO 13
- **Purpose**: Controls gimbal rotation around vertical axis (left/right)
- **Signal Type**: PWM (Pulse Width Modulation)
- **Voltage**: 3.3V logic level signal
- **Frequency**: 50 Hz (standard servo PWM)
- **Pulse Width Range**: 500-2500 µs
- **Angle Range**: 0° to 180°
- **Center Position**: 90° (1500 µs pulse)
- **Power**: Servo power (5V) must come from external supply, NOT from ESP32
- **Connection**:
  ```
  ESP32 GPIO 13 → Servo Signal Wire (Orange/Yellow)
  5V Power Supply → Servo Power Wire (Red)
  GND (Common) → Servo Ground Wire (Brown/Black)
  ```

#### 2. Pitch Servo - GPIO 12
- **Purpose**: Controls gimbal tilt forward and backward
- **Signal Type**: PWM (Pulse Width Modulation)
- **Voltage**: 3.3V logic level signal
- **Frequency**: 50 Hz (standard servo PWM)
- **Pulse Width Range**: 500-2500 µs
- **Angle Range**: 0° to 180°
- **Center Position**: 90° (1500 µs pulse)
- **Power**: Servo power (5V) must come from external supply, NOT from ESP32
- **Connection**:
  ```
  ESP32 GPIO 12 → Servo Signal Wire (Orange/Yellow)
  5V Power Supply → Servo Power Wire (Red)
  GND (Common) → Servo Ground Wire (Brown/Black)
  ```

#### 3. Roll Servo - GPIO 14
- **Purpose**: Controls gimbal tilt left and right
- **Signal Type**: PWM (Pulse Width Modulation)
- **Voltage**: 3.3V logic level signal
- **Frequency**: 50 Hz (standard servo PWM)
- **Pulse Width Range**: 500-2500 µs
- **Angle Range**: 0° to 180°
- **Center Position**: 90° (1500 µs pulse)
- **Power**: Servo power (5V) must come from external supply, NOT from ESP32
- **Connection**:
  ```
  ESP32 GPIO 14 → Servo Signal Wire (Orange/Yellow)
  5V Power Supply → Servo Power Wire (Red)
  GND (Common) → Servo Ground Wire (Brown/Black)
  ```

**Important Servo Notes**:
- All three servos share the same 5V power supply and GND
- Signal wires are independent
- Typical current draw per servo: 100-800 mA (depending on load)
- Total power supply should be rated for at least 3A
- Use common ground between ESP32 and servo power supply

---

### Gyroscope/Accelerometer (MPU6050)

#### 4. MPU6050 SDA - GPIO 8 (ESP32-S3)
- **Purpose**: I2C Data line for MPU6050 sensor communication
- **Signal Type**: I2C Data (SDA)
- **Voltage**: 3.3V logic level
- **Direction**: Bidirectional
- **Pull-up**: Internal pull-up enabled (or external 4.7kΩ to 3.3V)
- **I2C Address**: 0x68 (default) or 0x69 (if AD0 pin is HIGH)
- **Note**: GPIO 8/9 used for ESP32-S3 compatibility (GPIO 21/22 not available on S3)
- **Connection**:
  ```
  ESP32-S3 GPIO 8 → MPU6050 SDA pin
  ```

#### 5. MPU6050 SCL - GPIO 9 (ESP32-S3)
- **Purpose**: I2C Clock line for MPU6050 sensor communication
- **Signal Type**: I2C Clock (SCL)
- **Voltage**: 3.3V logic level
- **Direction**: Output (clock generated by ESP32)
- **Pull-up**: Internal pull-up enabled (or external 4.7kΩ to 3.3V)
- **Frequency**: 100 kHz (standard) or 400 kHz (fast mode)
- **Note**: GPIO 8/9 used for ESP32-S3 compatibility (GPIO 21/22 not available on S3)
- **Connection**:
  ```
  ESP32-S3 GPIO 9 → MPU6050 SCL pin
  ```

**MPU6050 Power Connections**:
```
ESP32 3.3V → MPU6050 VCC
ESP32 GND → MPU6050 GND
```

**Critical**: MPU6050 operates at 3.3V, NOT 5V! Applying 5V will damage the sensor.

**MPU6050 Full Connection Diagram**:
```
ESP32-S3        MPU6050
GPIO 8     →   SDA
GPIO 9     →   SCL
3.3V       →   VCC
GND        →   GND
```

---

### Control Button

#### 6. Control Button - GPIO 15
- **Purpose**: Hardware control button for manual operations
- **Signal Type**: Digital input
- **Voltage**: 3.3V logic level
- **Direction**: Input
- **Configuration**: INPUT_PULLUP (internal pull-up resistor enabled)
- **Active State**: LOW (button pressed)
- **Idle State**: HIGH (button released)
- **Debounce**: 50 ms (software debounce)
- **Connection**:
  ```
  ESP32-S3 GPIO 15 → One side of button
  GND → Other side of button
  ```
  Note: No external resistor needed due to internal pull-up

**Button Functions**:
- **Short Press** (< 3 seconds): Set current position as flat reference (zero position)
- **Long Press** (≥ 3 seconds): Run self-test routine (sweep all axes)

---

## Bench Test Pin Connections

### Minimal Bench Test Setup (Single Servo + BLE)
For testing mobile rotation control via Bluetooth:

```
REQUIRED CONNECTIONS:
1. Power:
   - ESP32 USB power OR 5V to VIN
   - External 5V supply to servo (if testing servo movement)
   
2. Test Servo (e.g., Yaw on GPIO 13):
   - ESP32 GPIO 13 → Servo Signal (Orange)
   - 5V Supply → Servo Power (Red)
   - GND (Common) → Servo Ground (Brown)
   
3. Ground:
   - ESP32 GND must connect to servo power supply GND

OPTIONAL FOR FULL TESTING:
4. MPU6050 (for gyro-stabilization testing):
   - ESP32-S3 GPIO 8 → MPU6050 SDA
   - ESP32-S3 GPIO 9 → MPU6050 SCL
   - ESP32-S3 3.3V → MPU6050 VCC
   - ESP32-S3 GND → MPU6050 GND
   
5. Status LED (built-in on ESP32-S3-N16R8):
   - No external connections needed
   - Observe LED color for system status:
     * RED = Critical error
     * YELLOW = Sensor missing (manual mode only)
     * GREEN (flashing) = Boot in progress
     * GREEN (solid) = All systems OK
```

---

## Power Supply Requirements

### ESP32 Power
- **Input Voltage**: 5V via USB or VIN pin (accepts 5-12V with onboard regulator)
- **Current Draw**: ~200-300 mA (without servos)
- **Power Source Options**:
  - USB cable (programming and power)
  - 5V regulated power supply to VIN
  - Battery pack with voltage regulator

### Servo Power
- **Voltage**: 5V (some servos accept 4.8-6V)
- **Current per Servo**: 100-800 mA (load dependent)
- **Total Current**: 3A minimum for 3 servos under load
- **Power Source**: External 5V power supply (NOT from ESP32)
- **Critical**: Share common GND with ESP32

### MPU6050 Power
- **Voltage**: 3.3V (from ESP32 3.3V pin)
- **Current**: ~3-5 mA
- **Power Source**: ESP32 3.3V regulator output

---

## Complete Wiring Diagram

```
                        ╔═══════════════╗
                        ║  ESP32-S3 Dev ║
                        ║    Board      ║
                        ╚═══════════════╝
                         │  │  │  │  │  │  │
                         │  │  │  │  │  │  └─ GPIO 48 (RGB LED - Internal)
                         │  │  │  │  │  └──── GPIO 13 → Yaw Servo Signal
                         │  │  │  │  └─────── GPIO 12 → Pitch Servo Signal
                         │  │  │  └────────── GPIO 14 → Roll Servo Signal
                         │  │  └───────────── GPIO 8 → MPU6050 SDA
                         │  └──────────────── GPIO 9 → MPU6050 SCL
                         └─────────────────── GPIO 15 → Button (to GND)

    ┌──────────────┐        ┌────────────┐
    │ 5V Power     │        │  MPU6050   │
    │ Supply (3A+) │        │   Sensor   │
    └──────────────┘        └────────────┘
         │  │                    │  │  │  │
         │  │                    │  │  │  └── GND → ESP32-S3 GND
         │  │                    │  │  └───── VCC → ESP32-S3 3.3V
         │  │                    │  └──────── SCL → GPIO 9
         │  └────────────────────┴─────────── SDA → GPIO 8
         │
         ├───────── Yaw Servo VCC (Red)
         ├───────── Pitch Servo VCC (Red)
         ├───────── Roll Servo VCC (Red)
         │
         └───────── Common GND (all servos + ESP32)
```

---

## Pin Configuration in Code

All pin definitions are located in: `esp32_firmware/include/config.h`

```cpp
// Servo Pin Configuration
#define SERVO_PIN_YAW 13
#define SERVO_PIN_PITCH 12
#define SERVO_PIN_ROLL 14

// MPU6050 Configuration (I2C) - ESP32-S3 compatible pins
#define MPU6050_SDA 8
#define MPU6050_SCL 9

// Button Configuration
#define BUTTON_PIN 15
#define BUTTON_DEBOUNCE_MS 50
#define BUTTON_LONG_PRESS_MS 3000

// RGB Status LED (ESP32-S3-N16R8 onboard)
// GPIO 48 - Managed by LEDStatusManager class
```

---

## Bluetooth Low Energy (BLE) Configuration

### BLE Communication (No GPIO Required)
- **Device Name**: `ESP32_Gimbal`
- **Service UUID**: `4fafc201-1fb5-459e-8fcc-c5c9c331914b`
- **Characteristics**:
  - **Position Control**: `beb5483e-36e1-4688-b7f5-ea07361b26a8` (Write)
  - **Mode Control**: `beb5483e-36e1-4688-b7f5-ea07361b26a9` (Write)
  - **Status**: `beb5483e-36e1-4688-b7f5-ea07361b26aa` (Read/Notify)

BLE uses internal radio - no external GPIO pins required.

---

## Available GPIO Pins (Unused)

The following ESP32 GPIO pins are currently unused and available for expansion:

| GPIO | Notes |
|------|-------|
| GPIO 0 | Boot mode pin - use with caution |
| GPIO 2 | Built-in LED on many boards |
| GPIO 4 | Available |
| GPIO 5 | Available |
| GPIO 16 | Available (may conflict with PSRAM) |
| GPIO 17 | Available (may conflict with PSRAM) |
| GPIO 18 | Available |
| GPIO 19 | Available |
| GPIO 23 | Available |
| GPIO 25 | Available (DAC1) |
| GPIO 26 | Available (DAC2) |
| GPIO 27 | Available |
| GPIO 32 | Available (ADC1_CH4) |
| GPIO 33 | Available (ADC1_CH5) |
| GPIO 34 | Input only (ADC1_CH6) |
| GPIO 35 | Input only (ADC1_CH7) |
| GPIO 36 | Input only (ADC1_CH0) |
| GPIO 39 | Input only (ADC1_CH3) |

**Do NOT use**:
- GPIO 6, 7, 8, 9, 10, 11 (connected to flash memory)
- GPIO 1, 3 (TX/RX for serial communication)

---

## Troubleshooting Pin Issues

### Servo Not Responding
1. Check signal wire connection to correct GPIO (13, 12, or 14)
2. Verify 5V power to servo
3. Ensure common ground between ESP32 and servo power
4. Measure voltage at servo power (should be ~5V)
5. Test servo with known working setup

### MPU6050 Not Detected
1. Verify I2C connections (GPIO 8 = SDA, GPIO 9 = SCL on ESP32-S3)
2. Check 3.3V power to MPU6050 (NOT 5V!)
3. Use I2C scanner sketch to detect device
4. Try adding external 4.7kΩ pull-up resistors on SDA/SCL
5. Check for short wires (< 15 cm recommended)
6. **Note**: System continues in degraded mode (manual only) if sensor fails - LED shows YELLOW

### Button Not Working
1. Verify connection to GPIO 15
2. Check other button terminal connects to GND
3. Test with multimeter (should show HIGH when released, LOW when pressed)
4. Check serial monitor for button press messages

---

## Safety Notes

⚠️ **IMPORTANT SAFETY WARNINGS**:

1. **Never connect servos to 3.3V** - Servos require 5V or higher
2. **Never connect MPU6050 to 5V** - MPU6050 operates at 3.3V only
3. **Never power servos from ESP32** - Use external power supply
4. **Always use common ground** - Connect ESP32 GND to servo power supply GND
5. **Check polarity** - Reversed polarity can damage components
6. **Adequate power supply** - Use 3A+ supply for reliable servo operation
7. **Avoid GPIO 6-11** - These are connected to flash memory

---

## Bench Test Procedure

### Step 1: Power-On Test (No Servos)
1. Connect ESP32-S3 via USB
2. Open serial monitor (115200 baud)
3. Verify boot messages and "System Ready" message
4. Check for WiFi connection or hotspot creation
5. **Observe RGB LED**: Should be GREEN (solid) if all OK, or YELLOW if sensor missing

### Step 2: BLE Connection Test
1. On mobile device, scan for BLE devices
2. Look for "ESP32_Gimbal"
3. Connect to device
4. Verify "BLE Client Connected" in serial monitor

### Step 3: Single Servo Test
1. Connect one servo (e.g., Yaw on GPIO 13)
2. Provide external 5V power to servo
3. Access web interface or use BLE app
4. Send position command (e.g., 90 degrees)
5. Verify servo moves to position
6. Test range: 0°, 90°, 180°

### Step 4: MPU6050 Test (Optional for BLE testing)
1. Connect MPU6050 to I2C pins (GPIO 8/9 on ESP32-S3)
2. Power cycle ESP32-S3
3. Check serial monitor for "MPU6050 initialized!" message
4. **Observe RGB LED**: Should change from YELLOW to GREEN when sensor detected
5. If fails: System continues in degraded mode (manual control only) with YELLOW LED

### Step 5: Mobile Rotation Control
1. Access web interface from phone
2. Enable phone gyroscope control OR use BLE app
3. Tilt phone to control servo
4. Verify real-time response

---

## Pin Change Instructions

To modify pin assignments:

1. Edit `esp32_firmware/include/config.h`
2. Update the relevant `#define` statement
3. Recompile and upload firmware
4. Update this documentation

Example:
```cpp
// To change Yaw servo from GPIO 13 to GPIO 25:
#define SERVO_PIN_YAW 25  // Changed from 13
```

---

## References

- [ESP32 Pinout Reference](https://randomnerdtutorials.com/esp32-pinout-reference-gpios/)
- [MPU6050 Datasheet](https://invensense.tdk.com/wp-content/uploads/2015/02/MPU-6000-Datasheet1.pdf)
- [Servo Motor Basics](https://www.arduino.cc/en/Tutorial/Foundations/Servo)
- [I2C Communication Protocol](https://www.i2c-bus.org/)

---

**Document Version**: 2.0  
**Last Updated**: January 2026  
**Firmware Compatibility**: v1.2+  
**Hardware**: ESP32-S3-N16R8 (ESP32-S3 DevKitC-1)
